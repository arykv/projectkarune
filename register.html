<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register ‚Äì Karune Connect</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/styles.css" />
  
  <!-- Google Maps API with Places Library -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAwa_h73kFdX1d-8f97YaK1dKrd6Vd2ETE&libraries=places&callback=initMap" async defer></script>
</head>

<body class="min-h-screen flex flex-col">

<!-- NAVBAR -->
<nav class="fixed top-0 inset-x-0 z-50">
  <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
    <div class="flex items-center space-x-3">
      <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-cyan-400 to-teal-400 flex items-center justify-center text-black font-bold">
        ‚ô•
      </div>
      <span class="text-xl font-semibold">Karune<span class="text-cyan-400">Connect</span></span>
    </div>

    <div class="flex items-center space-x-6">
      <a href="index.html">Home</a>
      <a href="login.html" class="btn-outline px-5 py-2 text-sm">Login</a>
    </div>
  </div>
</nav>

<!-- REGISTER SECTION -->
<main class="flex-1 flex items-center justify-center px-6 pt-32 pb-24 relative overflow-hidden">

  <!-- Glow -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute top-[-150px] left-1/2 -translate-x-1/2 w-[750px] h-[520px] bg-cyan-400/20 blur-[150px]"></div>
  </div>

  <!-- Register Card -->
  <div class="relative w-full max-w-3xl glass-card rounded-2xl p-8 md:p-10">

    <div class="text-center mb-10">
      <div class="w-14 h-14 mx-auto rounded-2xl bg-gradient-to-br from-cyan-400 to-teal-400 flex items-center justify-center text-black text-xl font-bold mb-4">
        ‚ô•
      </div>
      <h1 class="text-3xl md:text-4xl font-bold mb-2">Join Karune Connect</h1>
      <p class="text-slate-400">Create your account and start making a difference</p>
    </div>

    <form id="registerForm" class="space-y-6">

      <!-- Name -->
      <div>
        <label for="name" class="block text-sm mb-2 text-slate-300">Full Name</label>
        <input
          type="text"
          id="name"
          name="name"
          required
          placeholder="Your full name"
          class="w-full px-4 py-3 rounded-lg"
        />
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block text-sm mb-2 text-slate-300">Email Address</label>
        <input
          type="email"
          id="email"
          name="email"
          required
          placeholder="you@example.com"
          class="w-full px-4 py-3 rounded-lg"
        />
      </div>

      <!-- Password -->
      <div>
        <label for="password" class="block text-sm mb-2 text-slate-300">Password</label>
        <input
          type="password"
          id="password"
          name="password"
          minlength="6"
          required
          placeholder="At least 6 characters"
          class="w-full px-4 py-3 rounded-lg"
        />
        <p class="mt-1 text-xs text-slate-500">Minimum 6 characters</p>
      </div>

      <!-- Role Selection -->
      <div>
        <p class="block text-sm mb-4 text-slate-300">I want to join as</p>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="roleSelection">

          <!-- Sponsor -->
          <label class="cursor-pointer">
            <input type="radio" name="role" value="sponsor" class="peer hidden" required />
            <div class="glass-card rounded-xl p-5 text-center transition peer-checked:ring-2 peer-checked:ring-cyan-400 peer-checked:shadow-lg">
              <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-cyan-400/20 flex items-center justify-center text-cyan-400 font-bold">
                $
              </div>
              <h3 class="font-semibold mb-1">Sponsor</h3>
              <p class="text-sm text-slate-400">Support through donations</p>
            </div>
          </label>

          <!-- Volunteer -->
          <label class="cursor-pointer">
            <input type="radio" name="role" value="volunteer" class="peer hidden" />
            <div class="glass-card rounded-xl p-5 text-center transition peer-checked:ring-2 peer-checked:ring-cyan-400 peer-checked:shadow-lg">
              <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-cyan-400/20 flex items-center justify-center text-cyan-400 font-bold">
                ü§ù
              </div>
              <h3 class="font-semibold mb-1">Volunteer</h3>
              <p class="text-sm text-slate-400">Give your time & skills</p>
            </div>
          </label>

          <!-- Shelter -->
          <label class="cursor-pointer">
            <input type="radio" name="role" value="shelter" class="peer hidden" />
            <div class="glass-card rounded-xl p-5 text-center transition peer-checked:ring-2 peer-checked:ring-cyan-400 peer-checked:shadow-lg">
              <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-cyan-400/20 flex items-center justify-center text-cyan-400 font-bold">
                üè†
              </div>
              <h3 class="font-semibold mb-1">Shelter</h3>
              <p class="text-sm text-slate-400">Post your needs</p>
            </div>
          </label>

        </div>
      </div>

      <!-- SHELTER SPECIFIC FIELDS -->
      <div id="shelterFields" class="hidden space-y-4 pt-4 border-t border-slate-700">
        <h3 class="text-lg font-semibold text-slate-300">Shelter Details</h3>
        
        <div>
          <label class="block text-sm mb-2 text-slate-300">Shelter Type</label>
          <select name="shelterType" class="w-full px-4 py-3 rounded-lg">
            <option value="">Select type</option>
            <option value="orphanage">Orphanage</option>
            <option value="old-age-home">Old Age Home</option>
            <option value="community">Community Shelter</option>
            <option value="rehabilitation">Rehabilitation Center</option>
          </select>
        </div>

        <div>
          <label class="block text-sm mb-2 text-slate-300">Number of Beneficiaries</label>
          <input type="number" name="beneficiaryCount" placeholder="e.g. 50" class="w-full px-4 py-3 rounded-lg" />
        </div>

        <div>
          <label class="block text-sm mb-2 text-slate-300">Age Group</label>
          <select name="ageGroup" class="w-full px-4 py-3 rounded-lg">
            <option value="">Select age group</option>
            <option value="children">Children (0-18)</option>
            <option value="adults">Adults (18-60)</option>
            <option value="elderly">Elderly (60+)</option>
            <option value="mixed">Mixed Ages</option>
          </select>
        </div>

        <div>
          <label class="block text-sm mb-2 text-slate-300">Contact Phone</label>
          <input type="tel" name="contactPhone" placeholder="+91 XXXXX XXXXX" class="w-full px-4 py-3 rounded-lg" />
        </div>

        <div>
          <label class="block text-sm mb-2 text-slate-300">
            üìç City / Location
            <span class="text-xs text-slate-500 ml-2">(Start typing to search)</span>
          </label>
          <div class="relative">
            <input 
              type="text" 
              id="shelterCity" 
              name="city" 
              placeholder="Search for your city..." 
              class="w-full px-4 py-3 rounded-lg pr-10"
              autocomplete="off"
            />
            <button 
              type="button" 
              id="shelterLocationBtn"
              class="absolute right-2 top-1/2 -translate-y-1/2 p-2 text-cyan-400 hover:bg-cyan-400/10 rounded-lg transition"
              title="Use my current location"
            >
              üìç
            </button>
          </div>
          <p class="text-xs text-slate-500 mt-1" id="shelterLocationHint">Select a location for accurate matching</p>
          <input type="hidden" id="shelterLat" name="latitude" />
          <input type="hidden" id="shelterLng" name="longitude" />
        </div>
      </div>

      <!-- SPONSOR SPECIFIC FIELDS -->
      <div id="sponsorFields" class="hidden space-y-4 pt-4 border-t border-slate-700">
        <h3 class="text-lg font-semibold text-slate-300">Sponsor Profile</h3>
        
        <div>
          <label class="block text-sm mb-2 text-slate-300">Organization Type</label>
          <select name="orgType" class="w-full px-4 py-3 rounded-lg">
            <option value="">Select type</option>
            <option value="individual">Individual</option>
            <option value="corporate">Corporate/CSR</option>
            <option value="foundation">Foundation</option>
          </select>
        </div>

        <div>
          <label class="block text-sm mb-2 text-slate-300">Preferred Categories</label>
          <div class="space-y-2">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="preferredCategories" value="Food" class="w-4 h-4 rounded" />
              <span class="text-sm">Food & Nutrition</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="preferredCategories" value="Clothing" class="w-4 h-4 rounded" />
              <span class="text-sm">Clothing & Apparel</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="preferredCategories" value="Education" class="w-4 h-4 rounded" />
              <span class="text-sm">Education & Learning</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="preferredCategories" value="Healthcare" class="w-4 h-4 rounded" />
              <span class="text-sm">Healthcare & Medicine</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="preferredCategories" value="Essentials" class="w-4 h-4 rounded" />
              <span class="text-sm">Daily Essentials</span>
            </label>
          </div>
        </div>

        <div>
          <label class="block text-sm mb-2 text-slate-300">Donation Type</label>
          <select name="donationType" class="w-full px-4 py-3 rounded-lg">
            <option value="">Select type</option>
            <option value="monetary">Monetary</option>
            <option value="goods">Goods/Materials</option>
            <option value="both">Both</option>
          </select>
        </div>

        <div>
          <label class="block text-sm mb-2 text-slate-300">
            üìç City / Location
            <span class="text-xs text-slate-500 ml-2">(Start typing to search)</span>
          </label>
          <div class="relative">
            <input 
              type="text" 
              id="sponsorCity" 
              name="city" 
              placeholder="Search for your city..." 
              class="w-full px-4 py-3 rounded-lg pr-10"
              autocomplete="off"
            />
            <button 
              type="button" 
              id="sponsorLocationBtn"
              class="absolute right-2 top-1/2 -translate-y-1/2 p-2 text-cyan-400 hover:bg-cyan-400/10 rounded-lg transition"
              title="Use my current location"
            >
              üìç
            </button>
          </div>
          <p class="text-xs text-slate-500 mt-1" id="sponsorLocationHint">Select a location for personalized recommendations</p>
          <input type="hidden" id="sponsorLat" name="latitude" />
          <input type="hidden" id="sponsorLng" name="longitude" />
        </div>
      </div>

      <!-- VOLUNTEER SPECIFIC FIELDS -->
      <div id="volunteerFields" class="hidden space-y-4 pt-4 border-t border-slate-700">
        <h3 class="text-lg font-semibold text-slate-300">Volunteer Profile</h3>
        
        <div>
          <label class="block text-sm mb-2 text-slate-300">Your Skills</label>
          <div class="space-y-2">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="skills" value="teaching" class="w-4 h-4 rounded" />
              <span class="text-sm">Teaching/Tutoring</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="skills" value="healthcare" class="w-4 h-4 rounded" />
              <span class="text-sm">Healthcare/Medical</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="skills" value="cooking" class="w-4 h-4 rounded" />
              <span class="text-sm">Cooking</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="skills" value="counseling" class="w-4 h-4 rounded" />
              <span class="text-sm">Counseling</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="skills" value="delivery" class="w-4 h-4 rounded" />
              <span class="text-sm">Delivery/Logistics</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="skills" value="administration" class="w-4 h-4 rounded" />
              <span class="text-sm">Administration</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="skills" value="mentoring" class="w-4 h-4 rounded" />
              <span class="text-sm">Mentoring</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" name="skills" value="technical" class="w-4 h-4 rounded" />
              <span class="text-sm">Technical/IT</span>
            </label>
          </div>
        </div>

        <div>
          <label class="block text-sm mb-2 text-slate-300">Availability</label>
          <select name="availability" class="w-full px-4 py-3 rounded-lg">
            <option value="">Select availability</option>
            <option value="weekdays">Weekdays</option>
            <option value="weekends">Weekends</option>
            <option value="flexible">Flexible</option>
          </select>
        </div>

        <div>
          <label class="block text-sm mb-2 text-slate-300">Preferred Age Group</label>
          <select name="preferredAgeGroup" class="w-full px-4 py-3 rounded-lg">
            <option value="">Select preference</option>
            <option value="children">Children</option>
            <option value="elderly">Elderly</option>
            <option value="any">Any Age Group</option>
          </select>
        </div>

        <div>
          <label class="block text-sm mb-2 text-slate-300">
            üìç City / Location
            <span class="text-xs text-slate-500 ml-2">(Start typing to search)</span>
          </label>
          <div class="relative">
            <input 
              type="text" 
              id="volunteerCity" 
              name="city" 
              placeholder="Search for your city..." 
              class="w-full px-4 py-3 rounded-lg pr-10"
              autocomplete="off"
            />
            <button 
              type="button" 
              id="volunteerLocationBtn"
              class="absolute right-2 top-1/2 -translate-y-1/2 p-2 text-cyan-400 hover:bg-cyan-400/10 rounded-lg transition"
              title="Use my current location"
            >
              üìç
            </button>
          </div>
          <p class="text-xs text-slate-500 mt-1" id="volunteerLocationHint">Select a location for nearby opportunities</p>
          <input type="hidden" id="volunteerLat" name="latitude" />
          <input type="hidden" id="volunteerLng" name="longitude" />
        </div>
      </div>

      <!-- Error -->
      <div
        id="errorMessage"
        class="hidden bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 rounded-lg text-sm"
      ></div>

      <!-- Submit -->
      <button
        type="submit"
        id="submitBtn"
        class="btn-primary w-full py-3 text-base"
      >
        Create Account
      </button>

      <div class="text-center text-sm text-slate-400">
        Already have an account?
        <a href="login.html" class="text-cyan-400 hover:underline">Sign in</a>
      </div>

    </form>
  </div>
</main>

<!-- FOOTER -->
<footer class="py-6 text-center text-xs text-slate-500">
  ¬© 2024 Project Karune. Made with ‚ô• for humanity.
</footer>

<script type="module">
  import { signUpWithEmail } from './js/auth.js';
  import { showToast } from './js/app.js';
  import { initLocationPicker, getCurrentLocation } from './js/location.js';

  // Initialize Google Maps callback
  window.initMap = function() {
    console.log('Google Maps API loaded successfully');
  };

  // Auto-select role from URL parameter
  const urlParams = new URLSearchParams(window.location.search);
  const roleParam = urlParams.get('role');

  if (roleParam) {
    const roleInput = document.querySelector(`input[value="${roleParam}"]`);
    if (roleInput) {
      roleInput.checked = true;
      roleInput.dispatchEvent(new Event('change'));
    }
  }

  // Store location data for each role
  let locationData = {
    shelter: null,
    sponsor: null,
    volunteer: null
  };

  // Show/hide role-specific fields
  document.querySelectorAll('input[name="role"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      // Hide all role fields
      document.getElementById('shelterFields').classList.add('hidden');
      document.getElementById('sponsorFields').classList.add('hidden');
      document.getElementById('volunteerFields').classList.add('hidden');

      const role = e.target.value;
      
      // Show relevant role fields and initialize location picker
      if (role === 'shelter') {
        document.getElementById('shelterFields').classList.remove('hidden');
        setTimeout(() => initLocationPicker('shelterCity', (data) => {
          locationData.shelter = data;
          document.getElementById('shelterLat').value = data.coordinates.lat;
          document.getElementById('shelterLng').value = data.coordinates.lng;
          document.getElementById('shelterLocationHint').textContent = 
            `‚úì Location set: ${data.city}, ${data.state}`;
          document.getElementById('shelterLocationHint').classList.add('text-green-400');
        }), 100);
      } else if (role === 'sponsor') {
        document.getElementById('sponsorFields').classList.remove('hidden');
        setTimeout(() => initLocationPicker('sponsorCity', (data) => {
          locationData.sponsor = data;
          document.getElementById('sponsorLat').value = data.coordinates.lat;
          document.getElementById('sponsorLng').value = data.coordinates.lng;
          document.getElementById('sponsorLocationHint').textContent = 
            `‚úì Location set: ${data.city}, ${data.state}`;
          document.getElementById('sponsorLocationHint').classList.add('text-green-400');
        }), 100);
      } else if (role === 'volunteer') {
        document.getElementById('volunteerFields').classList.remove('hidden');
        setTimeout(() => initLocationPicker('volunteerCity', (data) => {
          locationData.volunteer = data;
          document.getElementById('volunteerLat').value = data.coordinates.lat;
          document.getElementById('volunteerLng').value = data.coordinates.lng;
          document.getElementById('volunteerLocationHint').textContent = 
            `‚úì Location set: ${data.city}, ${data.state}`;
          document.getElementById('volunteerLocationHint').classList.add('text-green-400');
        }), 100);
      }
    });
  });

  // Current location buttons
  document.getElementById('shelterLocationBtn')?.addEventListener('click', () => {
    getCurrentLocation(
      (data) => {
        document.getElementById('shelterCity').value = data.city;
        locationData.shelter = data;
        document.getElementById('shelterLat').value = data.coordinates.lat;
        document.getElementById('shelterLng').value = data.coordinates.lng;
        document.getElementById('shelterLocationHint').textContent = 
          `‚úì Location detected: ${data.city}, ${data.state}`;
        document.getElementById('shelterLocationHint').classList.add('text-green-400');
        showToast(`Location set to ${data.city}`, 'success');
      },
      (error) => showToast(error, 'error')
    );
  });

  document.getElementById('sponsorLocationBtn')?.addEventListener('click', () => {
    getCurrentLocation(
      (data) => {
        document.getElementById('sponsorCity').value = data.city;
        locationData.sponsor = data;
        document.getElementById('sponsorLat').value = data.coordinates.lat;
        document.getElementById('sponsorLng').value = data.coordinates.lng;
        document.getElementById('sponsorLocationHint').textContent = 
          `‚úì Location detected: ${data.city}, ${data.state}`;
        document.getElementById('sponsorLocationHint').classList.add('text-green-400');
        showToast(`Location set to ${data.city}`, 'success');
      },
      (error) => showToast(error, 'error')
    );
  });

  document.getElementById('volunteerLocationBtn')?.addEventListener('click', () => {
    getCurrentLocation(
      (data) => {
        document.getElementById('volunteerCity').value = data.city;
        locationData.volunteer = data;
        document.getElementById('volunteerLat').value = data.coordinates.lat;
        document.getElementById('volunteerLng').value = data.coordinates.lng;
        document.getElementById('volunteerLocationHint').textContent = 
          `‚úì Location detected: ${data.city}, ${data.state}`;
        document.getElementById('volunteerLocationHint').classList.add('text-green-400');
        showToast(`Location set to ${data.city}`, 'success');
      },
      (error) => showToast(error, 'error')
    );
  });

  // Form submission
  document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const submitBtn = document.getElementById('submitBtn');
    const errorDiv = document.getElementById('errorMessage');

    errorDiv.classList.add('hidden');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Creating account...';

    const formData = new FormData(e.target);
    const name = formData.get('name');
    const email = formData.get('email');
    const password = formData.get('password');
    const role = formData.get('role');

    // Build role-specific data
    let roleData = {};
    
    if (role === 'shelter') {
      roleData = {
        shelterType: formData.get('shelterType'),
        beneficiaryCount: parseInt(formData.get('beneficiaryCount')) || 0,
        ageGroup: formData.get('ageGroup'),
        contactPhone: formData.get('contactPhone'),
        city: formData.get('city'),
        coordinates: {
          lat: parseFloat(formData.get('latitude')) || null,
          lng: parseFloat(formData.get('longitude')) || null
        }
      };
    } else if (role === 'sponsor') {
      const categories = formData.getAll('preferredCategories');
      roleData = {
        orgType: formData.get('orgType'),
        preferredCategories: categories,
        donationType: formData.get('donationType'),
        city: formData.get('city'),
        coordinates: {
          lat: parseFloat(formData.get('latitude')) || null,
          lng: parseFloat(formData.get('longitude')) || null
        }
      };
    } else if (role === 'volunteer') {
      const skills = formData.getAll('skills');
      roleData = {
        skills: skills,
        availability: formData.get('availability'),
        preferredAgeGroup: formData.get('preferredAgeGroup'),
        city: formData.get('city'),
        coordinates: {
          lat: parseFloat(formData.get('latitude')) || null,
          lng: parseFloat(formData.get('longitude')) || null
        }
      };
    }

    const result = await signUpWithEmail(name, email, password, role, roleData);

    if (result.success) {
      showToast('Account created successfully! üéâ', 'success');
      setTimeout(() => {
        if (role === 'sponsor') {
          window.location.href = 'dashboard-sponsor.html';
        } else if (role === 'volunteer') {
          window.location.href = 'dashboard-volunteer.html';
        } else if (role === 'shelter') {
          window.location.href = 'dashboard-shelter.html';
        } else {
          window.location.href = 'index.html';
        }
      }, 1000);
    } else {
      errorDiv.textContent = result.error || 'Registration failed. Please try again.';
      errorDiv.classList.remove('hidden');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Create Account';
    }
  });
</script>

</body>
</html>